# This file is generated by Nx.
#
# Build the docker image with `npx nx docker-build ui`.
# Tip: Modify "docker-build" options in project.json to change docker build args.
#
# Run the container with `docker run -p 3000:3000 -t ui`.
FROM node:current-alpine AS BUILD

WORKDIR /app
COPY ../../dist/apps/ui ./ui
# You can remove this install step if you build with `--bundle` option.
# The bundled output will include external dependencies.
RUN npm --prefix ./ui --omit=dev install

FROM node:current-alpine AS SERVE

WORKDIR /app
COPY --from=BUILD /app/ui ./ui
#COPY --from=BUILD /app/ui/node_modules ./ui/node_modules

RUN addgroup --system ui && \
    adduser --system -G ui ui

RUN chown -R ui:ui ./ui

ENV HOST=0.0.0.0
ENV PORT=4200
USER ui
CMD [ "npx", "ng", "serve", "--host", "0.0.0.0", "--port", "4200" ]
